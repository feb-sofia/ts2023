<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to Time Series Analysis 2023/2024 - 3&nbsp; Linear Difference Equations</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./references.html" rel="next">
<link href="./02-Statistics-Review.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03-linear-difference-equations.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Difference Equations</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Time Series Analysis 2023/2024</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General Information</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Statistics-Review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistics Review</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-linear-difference-equations.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Difference Equations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#first-order-difference-equations" id="toc-first-order-difference-equations" class="nav-link active" data-scroll-target="#first-order-difference-equations"><span class="header-section-number">3.1</span> First Order Difference Equations</a></li>
  <li><a href="#first-order-vector-difference-equations" id="toc-first-order-vector-difference-equations" class="nav-link" data-scroll-target="#first-order-vector-difference-equations"><span class="header-section-number">3.2</span> First-Order Vector Difference Equations</a></li>
  <li><a href="#second-order-linear-difference-equations" id="toc-second-order-linear-difference-equations" class="nav-link" data-scroll-target="#second-order-linear-difference-equations"><span class="header-section-number">3.3</span> Second-Order Linear Difference Equations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Difference Equations</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="first-order-difference-equations" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="first-order-difference-equations"><span class="header-section-number">3.1</span> First Order Difference Equations</h2>
<p>Difference equations describe the dynamic behavior of a sequence by relating the current value of a variable to its previous values.</p>
<p>Let us start with a simple difference equation defined by:</p>
<p><span class="math display">\[
y_{t} = \phi y_{t - 1} + e_t
\]</span></p>
<p>For example, imagine that it describes the value of your bank deposit. Suppose you receive an interest of 2 percent annually. In that case, the value of your account this year (<span class="math inline">\(y_t\)</span>) is equal to the value of the account the previous year plus the interest earned (<span class="math inline">\(\phi = 1 + 0.02\)</span>). You can think about <span class="math inline">\(e_t\)</span> as withdrawals or additional deposits to your account.</p>
<p>We want to achieve two goals. The first goal is to solve this equation by expressing <span class="math inline">\(y_t\)</span> as a function of some initial value <span class="math inline">\(y_0\)</span>, the time index <span class="math inline">\(t\)</span>, the parameter <span class="math inline">\(\phi\)</span> and the sequence of <span class="math inline">\(e_t\)</span>.</p>
<p>It helps if we write the equation for a couple of periods.</p>
<p><span class="math display">\[
\begin{align}
1 &amp; \quad y_1 = \phi y_{0} + e_{1} \\
2 &amp; \quad y_2 = \phi y_{1} + e_{2} \\
2 &amp; \quad y_3 = \phi y_{2} + e_{3} \\
&amp; \vdots \\
t &amp; \quad y_{t} = \phi y_{t - 1} + e_{t} \\
t + 1 &amp;  \quad y_{t + 1} = \phi y_{t} + e_{t + 1}\\
t + 2 &amp; \quad y_{t + 2} = \phi y_{t + 1} + e_{t + 2}
\end{align}
\]</span></p>
<p>Try substituting the first equation into the second, then the second into the third equation.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click here to see the solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><span class="math display">\[
y_3 = \phi^3 y_0 + \phi^2 e_{1} + \phi e_{2} + \phi^0e_{3}
\]</span></p>
</div>
</div>
</div>
<p>You can generalize this for <span class="math inline">\(y_t\)</span>:</p>
<p><span class="math display">\[
y_{t + j} = \phi^{j + 1} y_{t - 1} + \phi^{j}e_{t} + \phi^{j - 1} e_{t + 1} + \ldots \phi^1 e_{t + j - 1} + \phi^0 e_{t + j}
\]</span> We can write this more compactly as:</p>
<p><span class="math display">\[
y_{t + j} = \phi^{j + 1} y_{t - 1} + \sum_{k = 0}^{j} \phi^{k} e_{t + j - k}
\]</span></p>
<p>You should check that the above formula is correct. Let’s write it down for <span class="math inline">\(j = 2\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click here to see the result
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><span class="math display">\[
\begin{align}
y_{t + 2} = \phi^{2 + 1}y_{t - 1} &amp; + \phi^0 e_{t + 2 - 0} \\
&amp; + \phi^{1} e_{t + 2 - 1} \\
&amp; + \phi^{2} e_{t + 2 - 2} \\
\end{align}
\]</span></p>
</div>
</div>
</div>
<p>Now that we know how to solve the equation, we can analyze the behavior of the dynamic system that it describes. It turns out that this behavior is determined by the parameter <span class="math inline">\(\phi\)</span>.</p>
<p>Let’s investigate the effect of a unit change in <span class="math inline">\(e_t\)</span> on <span class="math inline">\(y_{t + j}\)</span>, assuming that all other values of <span class="math inline">\(e\)</span> remain unchanged.</p>
<p><span class="math display">\[
\frac{\partial y_{t + j}}{\partial e_{t}} = \phi^j
\]</span> Note that the effect on <span class="math inline">\(y_{t}\)</span> only depends on the distance in time between the shock <span class="math inline">\(e_t\)</span> and the response <span class="math inline">\(y_{t + j}\)</span>, not on the time index itself. This is a property of <em>linear</em> difference equations.</p>
<p>Now, obviously, a unit shock in time <span class="math inline">\(t\)</span> will have a different effect on <span class="math inline">\(y_{t + j}\)</span> depending on the value of <span class="math inline">\(\phi\)</span>.</p>
<p>Another effect that we would like to analyze is the effect of a permanent unit change in the autonomous process <span class="math inline">\(e_t\)</span>. What will happen to <span class="math inline">\(y_t\)</span> if all <span class="math inline">\(e_t\)</span> increase by one unit?</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Click here to see the result
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><span class="math display">\[
y_{t + j} = \phi^{j + 1}y_{t - 1} + \sum_{k = 0}^{j}\phi^k e_{t + j - k}
\]</span></p>
<p><span class="math display">\[
\begin{align}
y^{*}_{t + j} &amp; = \phi^{j + 1}y_{t - 1} &amp; + \sum_{k = 0}^{j}\phi^k (e_{t + j - k} + 1) \\
              &amp; = \phi^{j + 1}y_{t - 1} &amp; + \sum_{k = 0}^{j}\phi^k e_{t + j - k} + \sum_{k = 0}^{j}\phi^k
\end{align}
\]</span></p>
<p>From this, it should be easy to see that</p>
<p><span class="math display">\[
y^{*}_{t + j} - y_{t + j} = \sum_{k = 0}^{j}\phi^k.
\]</span></p>
</div>
</div>
</div>
<p>The effect of a permanent unit change in <span class="math inline">\(e_t\)</span> is thus a power series in the parameter <span class="math inline">\(\phi\)</span>. At this point, it is helpful to remember a theorem from school about the limit of this series.</p>
<div id="thm-geometric-series" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.1 (Convergence of a Geometric Series) </strong></span><span class="math display">\[
S_{n} = 1 + \phi + \phi^2 + \phi^3 + \ldots + \phi^n
\]</span></p>
<p>Assuming that <span class="math inline">\(\phi \neq 1\)</span>, this series can be expressed more compactly as</p>
<p><span class="math display">\[
S_{n} = \frac{1 - \phi^{n + 1}}{1 - \phi}
\]</span></p>
<p>To see this, compute the difference between <span class="math inline">\(S_n\)</span> and <span class="math inline">\(\phi S_n\)</span> and rearrange.</p>
<p>If <span class="math inline">\(|\phi| &lt; 1 \iff -1 &lt; \phi &lt; 1\)</span> the series has a limit for <span class="math inline">\(n \to \infty\)</span>:</p>
<p><span class="math display">\[
\lim_{n \to \infty} S_{n} = \frac{1}{1 - \phi}
\]</span></p>
</div>
<div id="exr-geometric-series" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.1 (Geometric Series) </strong></span>To see how this series behaves, give it a try in R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This will give you a vector of the first 11 elements</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>dt_gseries <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">el =</span> phi<span class="sc">^</span>n,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co"># The geometric series is simply the cumulative sum of these elements</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">series =</span> <span class="fu">cumsum</span>(el)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>dt_gseries <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> n, <span class="at">y =</span> series)) <span class="sc">+</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03-linear-difference-equations_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
<p>Let us check</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">321</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the parameter phi</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>phi <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the initial value (y_{t - 1}) in the above notation</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>y_init <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the number of periods j</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">j =</span> <span class="dv">0</span><span class="sc">:</span>B,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate random values for e</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">e =</span> <span class="fu">rnorm</span>(<span class="at">n =</span> B <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add one to the first row of e</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">e_trans =</span> e <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="fu">rep</span>(<span class="dv">0</span>, B)),</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add one to all values of e</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">e_perm =</span> e <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute the powers of phi used to weight e/e_trans/e_perm</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">phi_powers =</span> phi<span class="sc">^</span>(B <span class="sc">-</span> j)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The following simply implements the formula for y</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> phi<span class="sc">^</span>(B <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> y_init <span class="sc">+</span> <span class="fu">sum</span>(e <span class="sc">*</span> phi_powers),</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_trans =</span> phi<span class="sc">^</span>(B <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> y_init <span class="sc">+</span> <span class="fu">sum</span>(e_trans <span class="sc">*</span> phi_powers),</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_perm =</span> phi<span class="sc">^</span>(B <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">*</span> y_init <span class="sc">+</span> <span class="fu">sum</span>(e_perm <span class="sc">*</span> phi_powers),</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_diff_trans =</span> y <span class="sc">-</span> y_trans,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_diff_perm =</span> y <span class="sc">-</span> y_perm</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">y</th>
<th style="text-align: right;">y_trans</th>
<th style="text-align: right;">y_perm</th>
<th style="text-align: right;">y_diff_trans</th>
<th style="text-align: right;">y_diff_perm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">1.89</td>
<td style="text-align: right;">-0.5</td>
<td style="text-align: right;">-1.5</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="exr-autonomous-solution" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.2 </strong></span>Given a first order difference equation with <span class="math inline">\(\phi = 0.8\)</span>, find the value of the process in <span class="math inline">\(t = 3\)</span>, knowing that it started with <span class="math inline">\(y_0 = 5\)</span>. Assume that <span class="math inline">\(e_t = 0\)</span> for all <span class="math inline">\(t\)</span>.</p>
</div>
<div class="solution proof">
<p><span class="proof-title"><em>Solution</em>. </span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Type your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="first-order-vector-difference-equations" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="first-order-vector-difference-equations"><span class="header-section-number">3.2</span> First-Order Vector Difference Equations</h2>
<p>In this course, we will focus exclusively on univariate time series analysis. Still, for the sake of motivating the study of higher-order linear difference equations, it is convenient to introduce vector linear difference equations. Let’s start with two variables, <span class="math inline">\(x_t\)</span> and <span class="math inline">\(y_t\)</span>.</p>
<p><span class="math display">\[
\begin{align}
x_{t} &amp; = \phi_{x,1}x_{t - 1} + \phi_{y, 1}y_{t - 1} + e_{x,t} \\
y_{t} &amp; = \phi_{x_2}x_{t - 1} + \phi_{y, 2}y_{t - 1} + e_{y,t}
\end{align}
\]</span></p>
<p>It is convenient to write this equation in matrix form.</p>
<p><span class="math display">\[
\underbrace{\begin{pmatrix}
x_{t} \\
y_{t}
\end{pmatrix}}_{\mathbf{z}_t}
= \underbrace{\begin{pmatrix}
\phi_{x, 1} &amp; \phi_{y, 1} \\
\phi_{x, 2} &amp; \phi_{y, 2}
\end{pmatrix} }_{\mathbf{A}}
\underbrace{\begin{pmatrix}
x_{t - 1} \\
y_{t - 1}
\end{pmatrix}}_{\mathbf{z}_{t - 1}} +
\underbrace{\begin{pmatrix}
e_{x,t} \\
e_{y,t}
\end{pmatrix}}_{\mathbf{e}_t}
\]</span></p>
<p><span class="math display">\[
\mathbf{z}_{t} = \mathbf{A} \mathbf{z}_{t - 1} + \mathbf{e}_{t}
\]</span></p>
<p>If <span class="math inline">\(\mathbf{A}\)</span> were a diagonal matrix, then we already know the solution because we can solve each equation separately.</p>
<p><span class="math display">\[
\underbrace{\begin{pmatrix}
x_{t} \\
y_{t}
\end{pmatrix}}_{\mathbf{z}_t}
= \underbrace{\begin{pmatrix}
\phi_{x,1} &amp; 0 \\
0 &amp; \phi_{y, 2}
\end{pmatrix} }_{\mathbf{A}}
\underbrace{\begin{pmatrix}
x_{t - 1} \\
y_{t - 1}
\end{pmatrix}}_{\mathbf{z}_{t - 1}} +
\underbrace{\begin{pmatrix}
e_{x,t} \\
e_{y,t}
\end{pmatrix}}_{\mathbf{e}_t}
\]</span></p>
<p>However, <span class="math inline">\(\mathbf{A}\)</span> depends on the subject matter at hand, and we need to be able to handle the general case (not diagonal). Linear algebra provides an elegant solution to our problem. The eigendecomposition of the matrix <span class="math inline">\(\mathbf{A}\)</span> allows us to transform the system of equations into a form where we can apply the simple solution. After solving the equations, we can back-transform to the original variables.</p>
<p><span class="math display">\[
\mathbf{A} = \mathbf{V}
\begin{pmatrix}
\lambda_1 &amp; 0 \\
0 &amp; \lambda_2
\end{pmatrix}
\mathbf{V}^{-1}
\]</span></p>
<p>Using this decomposition, we can transform the complicated problem to a simple one with only diagonal entries in the matrix before <span class="math inline">\(\mathbf{z}_{t - 1}\)</span>.</p>
<p><span class="math display">\[
\begin{align}
\mathbf{z}_{t} &amp; = \mathbf{A} \mathbf{z}_{t - 1} + \mathbf{e}_{t} \\
\mathbf{z}_{t} &amp; = \mathbf{V} \mathbf{\Lambda}\mathbf{V^{-1}} \mathbf{z}_{t - 1} + \mathbf{e}_{t} \\
\mathbf{V}^{-1} \mathbf{z}_{t} &amp; = \mathbf{V}^{-1} \mathbf{V}\mathbf{\Lambda}\mathbf{V}^{-1} \mathbf{z}_{t - 1} + \mathbf{V}^{-1}\mathbf{e}_{t} \\
\mathbf{V}^{-1} \mathbf{z}_{t} &amp; = \mathbf{\Lambda}\mathbf{V}^{-1} \mathbf{z}_{t - 1} + \mathbf{V}^{-1}\mathbf{e}_{t} \\
\tilde{\mathbf{z}}_{t} &amp; = \mathbf{\Lambda} \tilde{\mathbf{z}}_{t - 1} + \tilde{\mathbf{e}_{t}}
\end{align}
\]</span></p>
<p>Lets see an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">4</span>, <span class="dv">1</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    4
[2,]    9    1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>ed <span class="ot">&lt;-</span> <span class="fu">eigen</span>(B)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>ed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>eigen() decomposition
$values
[1]  7 -5

$vectors
          [,1]       [,2]
[1,] 0.5547002 -0.5547002
[2,] 0.8320503  0.8320503</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">solve</span>(ed<span class="sc">$</span>vectors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           [,1]      [,2]
[1,]  0.9013878 0.6009252
[2,] -0.9013878 0.6009252</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>ed<span class="sc">$</span>vectors <span class="sc">%*%</span> <span class="fu">diag</span>(ed<span class="sc">$</span>values) <span class="sc">%*%</span> <span class="fu">solve</span>(ed<span class="sc">$</span>vectors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    4
[2,]    9    1</code></pre>
</div>
</div>
<p>In this example the diagonal matrix <span class="math inline">\(\mathbf{\Lambda}\)</span> is equal to</p>
<p><span class="math display">\[
\mathbf{\Lambda} = \begin{pmatrix}
7 &amp; 0 \\
0 &amp; -5
\end{pmatrix}
\]</span> The inverse of the eigenvectors matrix is</p>
<p><span class="math display">\[
\mathbf{V}^{-1} = \begin{pmatrix}
0.9 &amp; 0.6 \\
-0.9 &amp; 0.6
\end{pmatrix}
\]</span></p>
<p>The transformed vectors <span class="math inline">\(\tilde{\mathbf{z}_{t}}\)</span> will look like:</p>
<p><span class="math display">\[
\tilde{\mathbf{z}_{t}} = \mathbf{V}^{-1}\mathbf{z}_t = \begin{pmatrix}
0.9 &amp; 0.6 \\
-0.9 &amp; 0.6
\end{pmatrix}
\begin{pmatrix}
x_{t} \\
y_{t}
\end{pmatrix}
=
\begin{pmatrix}
0.9x_t + 0.6y_t \\
-0.9x_t + 0.6 y_t
\end{pmatrix}
\]</span></p>
<p>The whole system looks like:</p>
<p><span class="math display">\[
\begin{pmatrix}
0.9x_t + 0.6y_t \\
-0.9x_t + 0.6 y_t
\end{pmatrix}
=
\begin{pmatrix}
7 &amp; 0 \\
0 &amp; -5
\end{pmatrix}
\begin{pmatrix}
0.9x_{t - 1} + 0.6y_{t - 1} \\
-0.9x_{t - 1} + 0.6 y_{t - 1}
\end{pmatrix}
+
\begin{pmatrix}
0.9e_{x,t} + 0.6e_{y,t} \\
-0.9e_{x,t} + 0.6 e_{y,t}
\end{pmatrix}
\]</span></p>
<p>Now, we can solve the difference equation in the simple case. Once we have found the solutions, we can transform it back to the original variables <span class="math inline">\(x_t\)</span> and <span class="math inline">\(y_t\)</span>.</p>
<p>For the purposes of this course, however, our focus lies on the behavior of the system: Does it converge to a stable path?</p>
<p>The answer is in the matrix <span class="math inline">\(\mathbf{A}\)</span>. When we start doing the the recursive substitution that we did in the scalar case, the transformed equations will look like this:</p>
<p><span class="math display">\[
\begin{align}
\tilde{\mathbf{z}}_{t} &amp; = \mathbf{\Lambda} \tilde{\mathbf{z}}_{t - 1} + \tilde{\mathbf{e}_{t}} \\
\tilde{\mathbf{z}}_{t} &amp; = \mathbf{\Lambda} (\mathbf{\Lambda} \tilde{\mathbf{z}}_{t - 1} + \tilde{\mathbf{e}_{t}}) + \tilde{\mathbf{e}_{t}} \\
\implies \tilde{\mathbf{z}}_{t} &amp; = \mathbf{\Lambda}^2 \tilde{\mathbf{z}}_{t - 1} +\mathbf{\Lambda} \tilde{\mathbf{e}_{t}} + \tilde{\mathbf{e}_{t}}
\end{align}
\]</span></p>
<p>You can continue the substitution just like we did in <a href="#exr-autonomous-solution">Exercise&nbsp;<span>3.2</span></a>. At this point, you should realize that the system’s behavior depends on the matrix <span class="math inline">\(\mathbf{\Lambda}\)</span>. If the elements of <span class="math inline">\(\mathbf{\Lambda|\)</span> are less than one in absolute value, the system will return to equilibrium after a shock. Otherwise, it will show explosive behavior. This leads us to the following problem: How do we find the values of the diagonal matrix? We will make use of a result from linear algebra.</p>
<div id="thm-eigenvalues" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.2 (Eigenvalues) </strong></span>The eigenvalues of a square matrix <span class="math inline">\(\mathbf{A}\)</span> are the solutions of the following equation.</p>
<p><span class="math display">\[
\det(\mathbf{A} - \lambda\mathbf{I}) = 0
\]</span></p>
</div>
</section>
<section id="second-order-linear-difference-equations" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="second-order-linear-difference-equations"><span class="header-section-number">3.3</span> Second-Order Linear Difference Equations</h2>
<p>In a second-order difference equation, the current value <span class="math inline">\(y_t\)</span> depends (directly) on the values up to two periods before it: <span class="math inline">\(y_{t - 1}\)</span> and <span class="math inline">\(y_{t - 2}\)</span>.</p>
<p><span class="math display">\[
y_{t} = \phi_{1}y_{t - 1} + \phi_{2}y_{t - 2} + e_{t}
\]</span></p>
<p>As in the first-order case, we want to investigate the stability property of this process: How does <span class="math inline">\(y_{t + j}\)</span> change in response to variations in the shocks (<span class="math inline">\(e_t\)</span>). It helps to express this equation as a first-order VAR process.</p>
<p><span class="math display">\[
\begin{align}
x_{t} &amp; = \phi_{1}x_{t - 1} + \phi_{2}x_{t - 2} + e_{t} \\
x_{t - 1} &amp; = x_{t - 1}
\end{align}
\]</span></p>
<p>The matrix for the VAR process is simple in this case.</p>
<p><span class="math display">\[
\begin{pmatrix}
x_t \\
x_{t - 1}
\end{pmatrix} =
\begin{pmatrix}
\phi_1 &amp; \phi_2 \\
1 &amp; 0
\end{pmatrix}
\begin{pmatrix}
x_{t - 1} \\
x_{t - 2}
\end{pmatrix}
+
\begin{pmatrix}
e_{t} \\
0
\end{pmatrix}
\]</span> We can use <a href="#thm-eigenvalues">Theorem&nbsp;<span>3.2</span></a> to find the eigenvalues of the matrix:</p>
<p><span class="math display">\[
\det(\mathbf{A} - \lambda\mathbf{I}) = 0
\]</span> In our case of a second-order difference equation, it is simply</p>
<p><span class="math display">\[
\det\begin{pmatrix}
\phi_1 - \lambda &amp; \phi_2 \\
1 &amp; 0 - \lambda
\end{pmatrix} = 0.
\]</span></p>
<p><span class="math display">\[
(\phi_1 - \lambda)(-\lambda) - \phi_2 \cdot 1 = 0 \\
\lambda^2 - \lambda \phi_1 - \phi_2 = 0
\]</span></p>
<p>The left-hand side of this equation is called the characteristic polynomial of the difference equation. The whole equation is called the <em>characteristic</em> equation.</p>
<p>Most of the time, we derive this equation using the lag operator:</p>
<p><span class="math display">\[
x_{t} = \phi_1 x_{t - 1} + \phi_2 x_{t - 2} + e_t \\
x_{t} = \phi_1 L x_{t} + \phi_2 L^2 x_{t} + e_{t} \\
(1 - \phi_1 L - \phi_2 L^2) x_{t} = e_{t}
\]</span></p>
<div id="thm-quadratic-eq" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.3 (Solutions of a Quadratic Equation) </strong></span>The solutions of a quadratic equation</p>
<p><span class="math display">\[
a \lambda^2 + b \lambda + c = 0
\]</span></p>
<p>are given by:</p>
<p><span class="math display">\[
\lambda_{1,2} = \frac{-b \pm\sqrt{b^2 - 4ac}}{2a}
\]</span></p>
<p><span class="math display">\[
(\lambda - \lambda_1)(\lambda - \lambda_2) = 0
\]</span></p>
</div>
<p>In the more general case, you can rely on the Fundamental Theorem of Algebra.</p>
<div id="thm-fundamental-theorem-algebra" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.4 (The Fundamental Theorem of Algebra) </strong></span>Any n-th order polynomial with complex coefficients has exactly n (possibly repeating) complex roots.</p>
<p><span class="math display">\[
a_0 + a_1 \lambda + a_2 \lambda^2 + \ldots a_n\lambda^n = 0
\]</span></p>
<p><span class="math display">\[
(\lambda - \lambda_1)(\lambda - \lambda_2)\cdot \ldots\cdot(\lambda - \lambda_n) = 0
\]</span></p>
</div>
<div id="exr-second-order-roots" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.3 (Characteristic roots) </strong></span>Find the characteristic roots of the following difference equation:</p>
<p><span class="math display">\[
y_t = y_{t - 1} + 0.2 y_{t - 2} + e_t
\]</span> Use <a href="#thm-quadratic-eq">Theorem&nbsp;<span>3.3</span></a> to compute the roots by hand. First, find the characteristic equation using matrix notation, then use the lag polynomial to derive it. Confirm your solution using the <code>polyroot</code> function in R. Is the equation stable?</p>
</div>
<div class="solution proof">
<p><span class="proof-title"><em>Solution</em>. </span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Type your code here</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02-Statistics-Review.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistics Review</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./references.html" class="pagination-link">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>