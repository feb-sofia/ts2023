<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Boyko Amarov">
<meta name="dcterms.date" content="2021-12-21">

<title>Introduction to Time Series Analysis 2023/2024 - 7&nbsp; Forecasting ARIMA processes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./09-GARCH.html" rel="next">
<link href="./06-Unit-Root-Tests.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./08-ARIMA-Forecasting.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Forecasting ARIMA processes</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Time Series Analysis 2023/2024</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">General Information</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-Introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-Statistics-Review.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Statistics Review</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-linear-difference-equations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Difference Equations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-AR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Autoregressive Processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Model-Fitting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">ARIMA Modeling (1)</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-Unit-Root-Tests.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">DF-test</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-ARIMA-Forecasting.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Forecasting ARIMA processes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-GARCH.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conditional Heteroskedasticity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#forecasting-with-arma-processes" id="toc-forecasting-with-arma-processes" class="nav-link active" data-scroll-target="#forecasting-with-arma-processes"><span class="header-section-number">8</span> Forecasting with ARMA processes</a>
  <ul class="collapse">
  <li><a href="#forecasting-with-ar1" id="toc-forecasting-with-ar1" class="nav-link" data-scroll-target="#forecasting-with-ar1"><span class="header-section-number">8.0.1</span> Forecasting with AR(1)</a></li>
  <li><a href="#forecasting-ma1" id="toc-forecasting-ma1" class="nav-link" data-scroll-target="#forecasting-ma1"><span class="header-section-number">8.1</span> Forecasting MA(1)</a></li>
  <li><a href="#forcasting-arima1-0-1" id="toc-forcasting-arima1-0-1" class="nav-link" data-scroll-target="#forcasting-arima1-0-1"><span class="header-section-number">8.2</span> Forcasting ARIMA(1, 0, 1)</a></li>
  <li><a href="#forecasting-arima-processes" id="toc-forecasting-arima-processes" class="nav-link" data-scroll-target="#forecasting-arima-processes"><span class="header-section-number">8.3</span> Forecasting ARIMA processes</a></li>
  <li><a href="#example-from-the-lecture-arima1-1-1" id="toc-example-from-the-lecture-arima1-1-1" class="nav-link" data-scroll-target="#example-from-the-lecture-arima1-1-1"><span class="header-section-number">8.4</span> Example from the Lecture: ARIMA(1, 1, 1)</a></li>
  <li><a href="#example-with-arima2-1-1" id="toc-example-with-arima2-1-1" class="nav-link" data-scroll-target="#example-with-arima2-1-1"><span class="header-section-number">8.5</span> Example with ARIMA(2, 1, 1)</a></li>
  <li><a href="#example-with-arima1-1-2" id="toc-example-with-arima1-1-2" class="nav-link" data-scroll-target="#example-with-arima1-1-2"><span class="header-section-number">8.6</span> Example with ARIMA(1, 1, 2)</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Forecasting ARIMA processes</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Boyko Amarov </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 21, 2021</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
</div>
<section id="forecasting-with-arma-processes" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Forecasting with ARMA processes</h1>
<p>Let <span class="math inline">\(y_t\)</span> follow a stationary ARMA process. The Wold decomposition states that every stationary ARMA process can be represented as MA(<span class="math inline">\(\infty\)</span>).</p>
<p><span class="math display">\[
\begin{align}
y_t = \mu + \sum_{j = 0}^{\infty} \psi_j e_{t - j}, \quad e_t \sim WN(\sigma^2)
\end{align}
\]</span></p>
<p>with the restriction that <span class="math inline">\(\psi_0 = 1\)</span> and that the square sum of the coefficients is finite:</p>
<p><span class="math display">\[
\sum_{j = 0}^{\infty} \psi_j^2 \le \infty.
\]</span></p>
<p>The latter condition ensures that the process has a finite variance. This representation is of limited practical use, because it contains an infinite number of parameters (which cannot be estimated with finite data). However, it helps to develop the theoretical properties of all ARMA processes. For example, the variance is really easy to calculate, because the lags of the white noise process are uncorrelated by assumption:</p>
<p><span class="math display">\[
\begin{align}
Var(y_t) &amp; = Var(\mu) + Var\left(\sum_{j = 0}^{\infty} \psi_j e_{t - j}\right) \\
&amp; = 0 + \sum_{j = 0}^{\infty} Var(\psi_j e_{t - j}) \\
&amp; = \sum_{j = 0}^{\infty} \psi_j^2 Var(e_{t - j}) \\
&amp; = \sum_{j = 0}^{\infty} \psi_j^2 \sigma^2 \\
&amp; = \sigma^2 \sum_{j = 0}^{\infty} \psi_j^2 \\
\end{align}
\]</span></p>
<p>Let</p>
<p><span class="math display">\[
\hat{y}_t(h) = \mu + \sum_{k = 0}^{\infty} \theta_k^{h} e_{t - k}
\]</span></p>
<p>be a function that predicts the value of a time series <span class="math inline">\(h\)</span> periods given the history of the series up to time <span class="math inline">\(t\)</span>. The error between the value of the process and the prediction for a <span class="math inline">\(h\)</span>-steps forecast is the difference between the value of the process <span class="math inline">\(y_{t + h}\)</span> and the forecast:</p>
<p><span class="math display">\[
y_{t + h} - \hat{y}_{t}(h)
\]</span></p>
<p>it can be shown, that the forecast function with the smallest expected squared error is the conditional expectation of <span class="math inline">\(y_{t + h}\)</span> given the information up to time <span class="math inline">\(t\)</span>.</p>
<p>To obtain an expression for the forecast error process, consider the conditional mean of the white noise process. We write <span class="math inline">\(E_t\)</span> to denote the conditional mean given the information up to and including time <span class="math inline">\(t\)</span>.</p>
<p><span class="math display">\[
\begin{align}
E_t(e_{t + h}) =
\begin{cases}
e_{t + h} &amp; h \leq 0 \\
0 &amp; h &gt; 0
\end{cases}
\end{align}
\]</span></p>
<p>The Wold representation of <span class="math inline">\(y_{t + h}\)</span> is</p>
<p><span class="math display">\[
y_{t + h} = \mu + \psi_0 e_{t + h} + \psi_1 e_{t + h - 1} + \ldots + \psi_h e_t + \psi_{h + 1} e_{t - 1} + \psi_{h + 1} e_{t - 1} + \ldots
\]</span></p>
<p>The conditional mean is:</p>
<p><span class="math display">\[
E_t(y_{t + h}) = \mu + E_t(\psi_0 e_{t + h}) + E_t(\psi_1 e_{t + h - 1}) + E_t(\ldots) + E_t(\psi_h e_t) + E_t(\psi_{h + 1} e_{t - 1}) + E_t(\psi_{h + 1} e_{t - 1}) + E_t(\ldots)\\
E_t(y_{t + h}) = \mu + \psi_h e_t + \psi_{h + 1} e_{t - 1} + \psi_{h + 1} e_{t - 1} + \ldots
\]</span></p>
<p>Therefore, the forecast error for the h-steps forecast is:</p>
<p><span class="math display">\[
\begin{align}
f_t(h) = y_{t + h} - E_t(y_{t + h}) = \psi_0 e_{t + h} + \psi_1 e_{t + h - 1} + \psi_2 e_{t + h - 2} +  \ldots
\end{align}
\]</span></p>
<p>In order to compute prediction intervals, we need the variance of the forecast errors. This is especially easy for the 1-step ahead forecast:</p>
<p><span class="math display">\[
f_t(1) = e_{t + 1}
\]</span></p>
<p>and its variance is simply the variance of <span class="math inline">\(e_{t + 1}\)</span> that we have set to <span class="math inline">\(\sigma^2\)</span> by assumption.</p>
<p><span class="math display">\[
Var(f_t(1)) = Var(e_{t + 1}) = \sigma^2
\]</span></p>
<p>For a two-steps ahead forecast we get:</p>
<p><span class="math display">\[
f_{t}(2) = e_{t + 2} + \psi_1 e_{t + 1}
\]</span></p>
<p>As the white noise process <span class="math inline">\(e_t\)</span> is uncorrelated (zero covariances), the variance of the forecast errors is simply the sum of the variances of the terms in the sum:</p>
<p><span class="math display">\[
Var(f_{t}(2)) = Var(e_{t + 2}) + Var(\psi_1 e_{t + 1})\\
Var(f_{t}(2)) = \sigma^2 + \psi_1^2 \sigma^2\\
Var(f_{t}(2)) = (1 + \psi_1^2) \sigma^2
\]</span></p>
<p>For the 3-steps ahead forecast:</p>
<p><span class="math display">\[
f_{t}(3) = e_{t + 3} + \psi_1 e_{t + 2} + \psi_2 e_{t + 1}\\
Var(f_{t}(3)) = (1 + \psi_1^2 + \psi_2^2)\sigma^2
\]</span></p>
<p>Continuing this, we can find the variance of the h-steps ahead forecast:</p>
<p><span class="math display">\[
Var(f_t(h)) = (1 + \psi_1^2 + \psi_2^2 + \ldots \psi_{h - 1}^2)\sigma^2
\]</span></p>
<p>To construct approximate 95% prediction intervals for time <span class="math inline">\(t + h\)</span> given the history of the process up to and including <span class="math inline">\(t\)</span>:</p>
<p><span class="math display">\[
\hat{y}_t(h) \pm 1.96 \sqrt{Var(f_t(h))}
\]</span></p>
<p>The <span class="math inline">\(1.96\)</span> factor is the <span class="math inline">\(0.975\)</span> quantile of the standard normal distribution. We must view these prediction intervals with caution, as these are based on the assumption that the forecast errors are approximately normally distributed, uncorrelated and with a constant variance over time. This prediction interval does not account for the uncertainty of estimation that is inherent in the fitting of any model, including the ARIMA models that we study here.</p>
<section id="forecasting-with-ar1" class="level3" data-number="8.0.1">
<h3 data-number="8.0.1" class="anchored" data-anchor-id="forecasting-with-ar1"><span class="header-section-number">8.0.1</span> Forecasting with AR(1)</h3>
<p>For a (stationary: <span class="math inline">\(|\phi_1| &lt; 1\)</span>) AR(1) process:</p>
<p><span class="math display">\[
y_{t} = \phi_0 + \phi_1 y_{t - 1} + e_t, e_t \sim WN(\sigma^2)
\]</span></p>
<p>The optimal forecast is the conditional mean of <span class="math inline">\(y_{t + h}\)</span> given the information (history of the process) up to and including <span class="math inline">\(t\)</span>. We write <span class="math inline">\(E_t\)</span> to denote this conditional expectation. For a white noise process <span class="math inline">\(e_t\)</span> the conditional expectation for <span class="math inline">\(t + h\)</span> is:</p>
<p><span class="math display">\[
E_t(e_{t + h}) = \begin{cases}
e_{t + h} &amp; h \leq 0 \\
0 &amp; h &gt; 0
\end{cases}
\]</span></p>
<p>the conditional mean at time <span class="math inline">\(t + h\)</span> is:</p>
<p><span class="math display">\[
\begin{align}
E_t(y_{t + h}) &amp; = E_t(\phi_0 + \phi_1 y_{t + h - 1} + e_{t + h}) \\
E_t(y_{t + h}) &amp; = \phi_0 + E_t(\phi_1 y_{t + h - 1}) \\
E_t(y_{t + h}) &amp; = \phi_0 + \phi_1 \hat{y}_{t}(h - 1)
\end{align}
\]</span></p>
<p>Finally, we obtain:</p>
<p><span class="math display">\[
\hat{y}_t(h) = \phi_0 + \phi_1 \hat{y}_{t}(h - 1)
\]</span></p>
<p>We can solve this by substituting recursively:</p>
<p>For <span class="math inline">\(h = 1\)</span>:</p>
<p><span class="math display">\[
\hat{y}_{t}(1) = \phi_0 + \phi_1 \hat{y}_t(0) = \phi_0 + \phi_1 y_{t}
\]</span></p>
<p>For <span class="math inline">\(h = 2\)</span>:</p>
<p><span class="math display">\[
\begin{align*}
\hat{y}_{t}(2)  &amp; = \phi_0 + \phi_1 \hat{y}_t(1) \\
&amp; = \phi_0 + \phi_1 (\phi_0 + \phi_1 \hat{y}_t(0)) \\
&amp; = \phi_0 + \phi_1 \phi_0 + \phi_1 ^2 \hat{y}_t(0) \\
&amp; = \phi_0 (1 + \phi_1) + \phi_1^2 y_{t}
\end{align*}
\]</span></p>
<p>Continuing with the substitution leads to:</p>
<p><span class="math display">\[
\begin{align*}
\hat{y}_t(h)    &amp; = \phi_0 (1 + \phi_1 + \phi_1^2 + \ldots + \phi_1^{h - 1}) + \phi_1^h y_{t} \\
&amp; = \frac{1 - \phi_1^h}{1 - \phi_1}\phi_0 + \phi_1^h x_{t}
\end{align*}
\]</span></p>
<p>To derive the variance of the forecast error it is convenient to use the MA(<span class="math inline">\(\infty\)</span>) representation of the AR(1) process (Wold representation).</p>
<p><span class="math display">\[
\begin{align}
y_t &amp; = \phi_0 + \phi_1 y_{t - 1} + e_t\\
(1 - \phi_1 L) y_{t} =  \\
y_{t} &amp; = \frac{\phi_0}{1 - \phi_1 L} + \frac{e_t}{1 - \phi_1 L} \\
y_{t} &amp; = \frac{\phi_0}{1 - \phi_1} + (1 + \phi_1 L + \phi_1^2 L^2 + \phi_1^3 L^3 + \ldots) e_{t}\\
y_{t} &amp; = \frac{\phi_0}{1 - \phi_1} + e_t + \phi_1 e_{t - 1} + \phi_1^2 e_{t - 2} + \phi_1^3 e_{t - 3} + \ldots \\
y_{t} &amp; = \mu + e_t + \phi_1 e_{t - 1} + \phi_1^2 e_{t - 2} + \phi_1^3 e_{t - 3} + \ldots
\end{align}
\]</span></p>
<p>We can use this equation to obtain the forecast error for the AR(1) process:</p>
<p><span class="math display">\[
f_t(h) = y_{t + h} - \hat{y}_t(h) = e_{t + h} + \phi_1 e_{t + h - 1} + \phi_1^2 e_{t + h - 1} + \ldots + \phi_1^{h - 1} e_{t + 1}
\]</span> Now it is easy to calculate the variance of the forecast error:</p>
<p><span class="math display">\[
\begin{align}
Var(f_t(h)) &amp; = \sigma^2 + \phi_1^2 \sigma^2 + \phi_1 ^ 4 \sigma^2 + \ldots + \phi_1^{2(h - 1)}\sigma^2 \\
&amp; = (1 + \phi_1^2 + \phi_1^4 + \ldots \phi_1^{2(h - 1)})\sigma^2\\
&amp; = \frac{1 - \phi_1^{2h}}{1 - \phi_1^2}\sigma^2
\end{align}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="at">n =</span> <span class="dv">100</span>, <span class="at">model =</span> <span class="fu">list</span>(<span class="at">ar =</span> <span class="fl">0.5</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>fit_AR1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(x, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>fit_AR1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Series: x 
ARIMA(1,0,0) with non-zero mean 

Coefficients:
         ar1    mean
      0.5938  0.2059
s.e.  0.0801  0.1932

sigma^2 = 0.6456:  log likelihood = -119.22
AIC=244.45   AICc=244.7   BIC=252.26</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">forecast</span>(fit_AR1, <span class="at">level =</span> <span class="fl">0.95</span>, <span class="at">h =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Point Forecast     Lo 95    Hi 95
101     0.00153243 -1.573317 1.576382</code></pre>
</div>
</div>
</section>
<section id="forecasting-ma1" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="forecasting-ma1"><span class="header-section-number">8.1</span> Forecasting MA(1)</h2>
<p>The moving average process of order one is given by:</p>
<p><span class="math display">\[
y_t = \phi_0 + e_t + \theta_1 e_{t - 1}
\]</span></p>
<p>The conditional (given the history up to and includnig <span class="math inline">\(t\)</span>) mean of <span class="math inline">\(y_{t + h}\)</span> is:</p>
<p><span class="math display">\[
E_t(y_{t + h}) = \phi_0 + E_t(e_{t + h}) + \theta_1 E_t (e_{t + h - 1})
\]</span></p>
<p>For a one step ahead prediction (<span class="math inline">\(h = 1\)</span>):</p>
<p><span class="math display">\[
E_{t}(y_{t + 1}) = \phi_0 + E_t(e_{t + 1}) + \theta_1 E_t(e_{t})
\]</span></p>
<p>Predictions for periods that exceed the order of the MA process (here we have <span class="math inline">\(q = 1\)</span>):</p>
<p><span class="math display">\[
E_t(y_{t + h}) = \phi_0
\]</span></p>
</section>
<section id="forcasting-arima1-0-1" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="forcasting-arima1-0-1"><span class="header-section-number">8.2</span> Forcasting ARIMA(1, 0, 1)</h2>
<p>Let us combine the methods used for forcasting the AR(1) and the MA(1) models.</p>
<p><span class="math display">\[
y_{t} = \phi_0 + \phi_1 y_{t - 1} + e_t + \theta_1 e_{t - 1}
\]</span></p>
<p>The conditional mean of <span class="math inline">\(y_{t + 1}\)</span> given the history of the process up to and including <span class="math inline">\(t\)</span> is:</p>
<p><span class="math display">\[
\hat{y}_t(1) = E_t(y_{t + 1}) = \phi_0 + \phi_1 y_t + E_t(e_{t + 1}) +  \theta_1 e_{t}
\]</span></p>
<p>The problem here is that <span class="math inline">\(e_t\)</span> is not observable, and therefore we cannot use the equation above directly. Instead, we need to estimate <span class="math inline">\(e_t\)</span> from the forecast errors:</p>
<p><span class="math display">\[
\hat{e}_t = y_{t} - \hat{y}_{t - 1}(1)
\]</span></p>
<p>For <span class="math inline">\(t = 0\)</span> the forecast is:</p>
<p><span class="math display">\[
\hat{y}_{0}(1) = \phi_0 + \phi_1 y_0 + \theta_1 e_0\\
\]</span></p>
<p>For <span class="math inline">\(t = 1\)</span>:</p>
<p><span class="math display">\[
\begin{align}
\hat{y}_{1}(1)  &amp; = \phi_0 + \phi_1 y_1 + \theta_1 e_1 \\
&amp; = \phi_0 + \phi_1 y_1 + \theta_1 (y_1 - \hat{y}_{0}(1)) \\
&amp; = \phi_0 + \phi_1 y_1 + \theta_1 (y_1 - (\phi_0 + \phi_1 y_0 + \theta_1 e_0)) \\
&amp; = \phi_0 (1 - \theta_1) + (\phi_1 + \theta_1)y_1 - \theta_1 \phi_1 y_0 + \theta_1^2e_0
\end{align}
\]</span></p>
<p>We can continue substituting until we finally get an (admittedly) long expression for the forecast at time <span class="math inline">\(t\)</span>.</p>
<p><span class="math display">\[
\begin{align}
\hat{y}_{t}(1) = &amp; \phi_0(1 -\theta_1 - \theta_1^2 - \theta_1^t) +\\
&amp; (\phi_1 - \theta_1) y_t - \theta_1(\phi_1 + \theta_1)) y_{t - 1} +\\
&amp; \ldots +\\
&amp; \theta_1^{t - 1}(\phi_1 + \theta_1) y_1 + \theta_1^t \phi_1 y_0 + \theta_1^{t + 1} e_0
\end{align}
\]</span></p>
<p>To calculate the predictions for more than one period, you can use the recursive relationship:</p>
<p><span class="math display">\[
\begin{align}
\hat{y}_t(2) = &amp; \phi_0 + \phi_1 \hat{y}_t(1)\\
\hat{y}_t(3) = &amp; \phi_0 + \phi_1 \hat{y}_t(2)\\
&amp; \vdots\\
\end{align}
\]</span></p>
</section>
<section id="forecasting-arima-processes" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="forecasting-arima-processes"><span class="header-section-number">8.3</span> Forecasting ARIMA processes</h2>
<p>If the process is ARIMA with <span class="math inline">\(d = 1\)</span>, then we need to de-difference the forecast:</p>
<p><span class="math display">\[
\hat{y}_t(h) = y_t + \phi_0 \hat{y}_{t}(1) + \phi_0 \hat{y}_{t}(2) + \ldots + \phi_0 \hat{y}_{t}(h)
\]</span></p>
<p>If the process is ARIMA with <span class="math inline">\(d = 2\)</span>:</p>
<p><span class="math display">\[
\hat{y}_t(h) = y_t + \left(\phi_0 y_t + \phi_0^2 \hat{y}_{t}(1)\right) + \left(\phi_0 y_t + \phi_0^2 \hat{y}_{t}(1) \phi_0^2 \hat{y}_t(2)\right) + \ldots + \left(\phi_0 y_t + \phi_0^2 \hat{y}_{t}(1) \phi_0^2 \hat{y}_t(2) + \ldots + \phi_0^2\hat{y}_t(h)\right)
\]</span></p>
</section>
<section id="example-from-the-lecture-arima1-1-1" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="example-from-the-lecture-arima1-1-1"><span class="header-section-number">8.4</span> Example from the Lecture: ARIMA(1, 1, 1)</h2>
<p><span class="math display">\[
\Delta y_t = 0.1 \Delta y_{t−1} + e_t + 0.2 e_{t−1}
\]</span></p>
<p>Compute the one-step ahead forecast of the model given the values</p>
<table class="table">
<colgroup>
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 21%">
<col style="width: 45%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th>t</th>
<th>y</th>
<th><span class="math inline">\(x _t = \Delta y_{t}\)</span></th>
<th><span class="math inline">\(\hat{x}_{t - 1}(1)\)</span></th>
<th><span class="math inline">\(\hat{e}_{t}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>0</td>
<td>-11</td>
<td>NA</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>13</td>
<td></td>
<td><span class="math inline">\(0\)</span></td>
</tr>
<tr class="even">
<td>2</td>
<td>5</td>
<td>3</td>
<td><span class="math inline">\(0.1\cdot(13) + 0.2\cdot 0 = 1.3\)</span></td>
<td><span class="math inline">\(3 - 1.3 = 1.7\)</span></td>
</tr>
<tr class="odd">
<td>3</td>
<td>-1</td>
<td>-6</td>
<td><span class="math inline">\(0.1\cdot(3) + 0.2\cdot 1.7 = 0.64\)</span></td>
<td><span class="math inline">\(-6 - 0.64 = -6.64\)</span></td>
</tr>
<tr class="even">
<td>4</td>
<td>13</td>
<td>14</td>
<td><span class="math inline">\(0.1\cdot(-6) + 0.2\cdot (-6.64) = -1.928\)</span></td>
<td><span class="math inline">\(14 - (-1.928) = 15.928\)</span></td>
</tr>
<tr class="odd">
<td>T=5</td>
<td>4</td>
<td>-9</td>
<td><span class="math inline">\(0.1\cdot(14) + 0.2\cdot (15.928) = 4.5856\)</span></td>
<td><span class="math inline">\(-9 - 4.5856 = -13.5856\)</span></td>
</tr>
<tr class="even">
<td>6</td>
<td>?</td>
<td></td>
<td><span class="math inline">\(0.1\cdot(-9) + 0.2\cdot (-13.5856) = -3.61712\)</span></td>
<td><span class="math inline">\(0\)</span></td>
</tr>
<tr class="odd">
<td>7</td>
<td>?</td>
<td></td>
<td><span class="math inline">\(0.1\cdot(-3.61712) + 0.2\cdot 0 = -0.361712\)</span></td>
<td></td>
</tr>
</tbody>
</table>
<p>To calculate the forecast, start with the observation at <span class="math inline">\(t = 2\)</span>. For the observations before that there are no available values. For the sake of convenience, we will set <span class="math inline">\(\Delta y_t = x_t\)</span>. The optimal forecast is given by the conditional mean of the series:</p>
<p><span class="math display">\[
\begin{align}
\hat{x}_{t}(1) &amp; = E_{t}(x_{t + 1}) = E_{t}(0.1 x_t + e_{t + 1} + 0.2 e_{t}) \\
\hat{x}_{t}(1) &amp; = E_{t}(x_{t + 1}) = 0.1 x_t + 0.2 \hat{e}_{t}
\end{align}
\]</span></p>
<p>Let’s calculate the one step ahead forecast for <span class="math inline">\(x_2\)</span>:</p>
<p><span class="math display">\[
\hat{x}_{1}(1) = E_{1}(x_{2}) = 0.1 x_1 + 0.2 \hat{e}_{1}
\]</span></p>
<p>For the next steps we will estimate <span class="math inline">\(e_{t}\)</span> from the forecast error but for the initial values (where we cannot compute the residual) we will set <span class="math inline">\(e_{1} = 0\)</span>. There are different ways to choose the initial values, but this is the simplest one and is used in the <code>predict.Arima</code> function in R. Note that that the example in the lecture uses another approach.</p>
<p><span class="math display">\[
\hat{x}_{1}(1) = 0.1 \cdot 13 + 0.2 \cdot 0 = 1.3
\]</span></p>
<p>The forecast for <span class="math inline">\(x_3\)</span> is:</p>
<p><span class="math display">\[
\begin{align}
\hat{x}_{2}(1) &amp; = 0.1 x_{2} + 0.2 \hat{e}_{2}\\
\hat{e}_{2} &amp; = x_2 - \hat{x}_1(1) = 3 - 1.3 = 1.7 \\
\hat{x}_{2}(1) &amp; = 0.1 \cdot 3 + 0.2 1.7 = 0.64 \\
\end{align}
\]</span></p>
<p>We repeat this calculation until we get to the final step. Note that when forecasting <span class="math inline">\(x_7\)</span> the forecast equation is:</p>
<p><span class="math display">\[
\hat{x}_{6}(1) = 0.1 \hat{x}_{6} = −0.36
\]</span></p>
<p>To get the prediction for <span class="math inline">\(y_5\)</span> and <span class="math inline">\(y_6\)</span>, use apply the formula for reversing the differencing (<span class="math inline">\(d = 1\)</span>):</p>
<p><span class="math display">\[
\hat{y}_t(h) = y_t + \phi_0 \hat{y}_{t}(1) + \phi_0 \hat{y}_{t}(2) + \ldots + \phi_0 \hat{y}_{t}(h)
\]</span></p>
<p>For the one step ahead prediction we obtain <span class="math inline">\((h = 1)\)</span>:</p>
<p><span class="math display">\[
\begin{align}
\hat{y}_t(1) &amp; = y_t + \hat{x}_t(1) \\
\hat{y}_5(1) &amp; = y_{5} + \hat{x}_5(1) = 4 + (−3.61712) = 0.38288
\end{align}
\]</span></p>
<p>For the two steps prediction we obtain <span class="math inline">\((h = 2)\)</span></p>
<p><span class="math display">\[
\begin{align}
\hat{y}_t(2) &amp; = y_t + \hat{x}_t(1) + \hat{x}_t(2) \\
\hat{y}_5(2) &amp; = y_{5} + \hat{x}_5(1) + \hat{x}_5(2) = 4 + (−3.61712) + (−0.361712) = 0.021168
\end{align}
\]</span></p>
<p>We can verify the prediction using <code>arima</code> and <code>predict</code>. First, we enter the values by hand and compute the first difference.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">11</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">13</span>, <span class="dv">4</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">diff</span>(y)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13  3 -6 14 -9</code></pre>
</div>
</div>
<p>Note that the default estimation method in <code>arima</code> is slighly different from what is shown in the table above. To reproduce the results, set the estimation method in <code>arima</code> to conditional sum of squares (CSS).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>fit_ARIMA_1_0_1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  x,</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## ARIMA(1, 0, 1)</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Fix the coefficients ar(1) = 0.1, ma(1) = 0.2 , delta = 0</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="do">## so that they do not get estimated from the data (you'll get different values)</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## and we want to use exactly the coefficients from the model for calculating the</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="do">## forecasts</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="dv">0</span>),</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"CSS"</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>fit_ARIMA_1_0_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = x, order = c(1, 0, 1), fixed = c(0.1, 0.2, 0), method = "CSS")

Coefficients:
      ar1        ma1  intercept  
      0.1        0.2        0.0  

sigma^2 estimated as 121.3:  part log likelihood = -19.09</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(fit_ARIMA_1_0_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 1 
End = 5 
Frequency = 1 
[1]   0.0000   1.7000  -6.6400  15.9280 -13.5856</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit_ARIMA_1_0_1, <span class="at">n.ahead =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
Time Series:
Start = 6 
End = 7 
Frequency = 1 
[1] -3.61330 -0.36133

$se
Time Series:
Start = 6 
End = 7 
Frequency = 1 
[1] 11.01419 11.49915</code></pre>
</div>
</div>
<p>You can also do it directly by setting the integration order of the arima process to 1. This time you pass the values of <code>y</code> to <code>arima</code> and not the differenced values in <code>x</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>fit_ARIMA_1_1_1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  y,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>),</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"CSS"</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>fit_ARIMA_1_1_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = y, order = c(1, 1, 1), fixed = c(0.1, 0.2), method = "CSS")

Coefficients:
ar1  ma1  
0.1  0.2  

sigma^2 estimated as 121.3:  part log likelihood = -19.09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit_ARIMA_1_1_1, <span class="at">n.ahead =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
Time Series:
Start = 7 
End = 8 
Frequency = 1 
[1] 0.38670020 0.02537022

$se
Time Series:
Start = 7 
End = 8 
Frequency = 1 
[1] 11.01419 18.06461</code></pre>
</div>
</div>
</section>
<section id="example-with-arima2-1-1" class="level2" data-number="8.5">
<h2 data-number="8.5" class="anchored" data-anchor-id="example-with-arima2-1-1"><span class="header-section-number">8.5</span> Example with ARIMA(2, 1, 1)</h2>
<p><span class="math display">\[
\Delta y_t = 0.1 \Delta y_{t−1} + 0.3 \phi_0 y_{t - 2} + e_t + 0.2 e_{t−1}
\]</span></p>
<p>Again, set <span class="math inline">\(x_t = \Delta y_{t}\)</span> to get a regular ARMA(2, 1) model.</p>
<p><span class="math display">\[
x_t = 0.1 x_{t - 1} + 0.3 x_{t - 2} + e_t + 0.2 e_{t−1}
\]</span></p>
<p>The optimal forecast is (again) the conditional mean of the process:</p>
<p><span class="math display">\[
\hat{x}_{t}(1) = 0.1 x_t + 0.3 x_{t - 1} + 0.2 \hat{e}_{t}
\]</span></p>
<p>Your first prediction will be for <span class="math inline">\(t = 3\)</span>, because you have no values for <span class="math inline">\(x\)</span> before <span class="math inline">\(t = 1\)</span>.</p>
<p><span class="math display">\[
\hat{x}_2(1) = 0.1x_{2} + 0.3 x_{1} + \hat{e}_{2} = 0.1 \cdot 3 + 0.3 \cdot 13 + 0 = 4.2
\]</span></p>
<p>As you cannot estimate <span class="math inline">\(e_2\)</span> from the residuals, set it to zero. With this estimate, the forecast error is</p>
<p><span class="math display">\[
\hat{e}_{3} = x_3 - \hat{x}_2(1) = -6 - 4.2 = -10.2
\]</span></p>
<p>You will use this error in the next step to calculate the forecast for <span class="math inline">\(x_4\)</span>:</p>
<p><span class="math display">\[
\hat{x}_3(1) = 0.1 x_{3} + 0.3 x_{2} + \hat{e}_3 = 0.1 \cdot (-6) + 0.3 \cdot 3 + 0.2 \cdot (-10.2) = -1.74
\]</span></p>
<p>You continue this way until you reach the <span class="math inline">\(t = 7\)</span>. Then you apply the de-differencing formula as in the previous example.</p>
<table class="table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 29%">
<col style="width: 27%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>t</th>
<th>y</th>
<th><span class="math inline">\(x _t = \Delta y_{t}\)</span></th>
<th><span class="math inline">\(\hat{x}_{t - 1}(1)\)</span></th>
<th><span class="math inline">\(\hat{e}_{t}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>0</td>
<td>-11</td>
<td>NA</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>13</td>
<td></td>
<td><span class="math inline">\(0\)</span></td>
</tr>
<tr class="even">
<td>2</td>
<td>5</td>
<td>3</td>
<td></td>
<td><span class="math inline">\(0\)</span></td>
</tr>
<tr class="odd">
<td>3</td>
<td>-1</td>
<td>-6</td>
<td>4.2</td>
<td><span class="math inline">\(-6 - 4.2 = -10.2\)</span></td>
</tr>
<tr class="even">
<td>4</td>
<td>13</td>
<td>14</td>
<td>-1.74</td>
<td><span class="math inline">\(14 - (-1.74) = 15.74\)</span></td>
</tr>
<tr class="odd">
<td>T=5</td>
<td>4</td>
<td>-9</td>
<td></td>
<td><span class="math inline">\(-11.748\)</span></td>
</tr>
<tr class="even">
<td>6</td>
<td>?</td>
<td></td>
<td></td>
<td><span class="math inline">\(0\)</span></td>
</tr>
<tr class="odd">
<td>7</td>
<td>?</td>
<td></td>
<td></td>
<td><span class="math inline">\(0\)</span></td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>fit_ARIMA_2_0_1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  x,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="dv">0</span>),</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"CSS"</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>fit_ARIMA_2_0_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = x, order = c(2, 0, 1), fixed = c(0.1, 0.3, 0.2, 0), method = "CSS")

Coefficients:
      ar1        ar2        ma1  intercept  
      0.1        0.3        0.2        0.0  

sigma^2 estimated as 163.3:  part log likelihood = -19.83</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(fit_ARIMA_2_0_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 1 
End = 5 
Frequency = 1 
[1]   0.000   0.000 -10.200  15.740 -11.748</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(fit_ARIMA_2_0_1, <span class="at">n.ahead =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
Time Series:
Start = 6 
End = 7 
Frequency = 1 
[1]  0.9534706 -2.6046529

$se
Time Series:
Start = 6 
End = 7 
Frequency = 1 
[1] 12.77763 13.34023</code></pre>
</div>
</div>
</section>
<section id="example-with-arima1-1-2" class="level2" data-number="8.6">
<h2 data-number="8.6" class="anchored" data-anchor-id="example-with-arima1-1-2"><span class="header-section-number">8.6</span> Example with ARIMA(1, 1, 2)</h2>
<p><span class="math display">\[
\Delta y_t = 0.1 \Delta y_{t−1} + e_t + 0.2 e_{t−1} + 0.3 e_{t -2}
\]</span></p>
<p>Substituting <span class="math inline">\(\Delta y_{t} = x_t\)</span>:</p>
<p><span class="math display">\[
x_t = 0.1 x_{t−1} + e_t + 0.2 e_{t−1} + 0.3 e_{t -2}
\]</span></p>
<p>The optimal forecast is given by:</p>
<p><span class="math display">\[
\hat{x}_{t}(1) = 0.1 x_{t} + 0.2 \hat{e}_{t} + 0.3 \hat{e}_{t - 1}
\]</span></p>
<p>The first prediction for <span class="math inline">\(x_2\)</span> is given by:</p>
<p><span class="math display">\[
\hat{x}_1(1) = 0.1 x_{1} + 0.2 \hat{e}_{1} + 0.3 \hat{e}_{0}
\]</span></p>
<p>Initializing the forecast error series with zeroes we get:</p>
<p><span class="math display">\[
\hat{x}_1(1) = 0.1 \cdot 13 + 0.2 \cdot 0 + 0.3 \cdot 0 = 1.3 \\
\hat{e}_2 = 3 - 1.3 = 1.7
\]</span></p>
<p>The next forecast error is:</p>
<p><span class="math display">\[
\hat{x}_2(1) = 0.1 x_{2} + 0.2 \hat{e}_2 + 0.3 \hat{e}_1\\
\hat{x}_2(1) = 0.1 \cdot 3 + 0.2 \cdot 1.7 + 0.3 \cdot 0 = 0.64\\
\hat{e}_3 = -6 - 0.64 = -6.64
\]</span></p>
<p>and then:</p>
<p><span class="math display">\[
\hat{x}_3(1) = 0.1 x_{3} + 0.2 \hat{e}_3 + 0.3 \hat{e}_2\\
\hat{x}_3(1) = 0.1 \cdot (-6) + 0.2 \cdot (-6.64) + 0.3 \cdot 1.7 = -1.418\\
\hat{e}_4 = 14 - (-1.418) = 15.418
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fit_ARIMA_1_0_2 <span class="ot">&lt;-</span> <span class="fu">arima</span>(</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>  x,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fixed =</span> <span class="fu">c</span>(<span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>, <span class="dv">0</span>),</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"CSS"</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>fit_ARIMA_1_0_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
arima(x = x, order = c(1, 0, 2), fixed = c(0.1, 0.2, 0.3, 0), method = "CSS")

Coefficients:
      ar1        ma1        ma2  intercept  
      0.1        0.2        0.3        0.0  

sigma^2 estimated as 104.2:  part log likelihood = -18.71</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(fit_ARIMA_1_0_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time Series:
Start = 1 
End = 5 
Frequency = 1 
[1]   0.0000   1.7000  -6.6400  15.4180 -11.4916</code></pre>
</div>
</div>
<table class="table">
<colgroup>
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 32%">
<col style="width: 30%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th>t</th>
<th>y</th>
<th><span class="math inline">\(x _t = \Delta y_{t}\)</span></th>
<th><span class="math inline">\(\hat{x}_{t - 1}(1)\)</span></th>
<th><span class="math inline">\(\hat{e}_{t}\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-1</td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>0</td>
<td>-11</td>
<td>NA</td>
<td></td>
<td><span class="math inline">\(0\)</span></td>
</tr>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>13</td>
<td></td>
<td><span class="math inline">\(0\)</span></td>
</tr>
<tr class="even">
<td>2</td>
<td>5</td>
<td>3</td>
<td>1.3</td>
<td><span class="math inline">\(1.7\)</span></td>
</tr>
<tr class="odd">
<td>3</td>
<td>-1</td>
<td>-6</td>
<td>0.64</td>
<td><span class="math inline">\(-6.64\)</span></td>
</tr>
<tr class="even">
<td>4</td>
<td>13</td>
<td>14</td>
<td></td>
<td><span class="math inline">\(15.418\)</span></td>
</tr>
<tr class="odd">
<td>T=5</td>
<td>4</td>
<td>-9</td>
<td></td>
<td><span class="math inline">\(-11.4916\)</span></td>
</tr>
<tr class="even">
<td>6</td>
<td>?</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>7</td>
<td>?</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./06-Unit-Root-Tests.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">DF-test</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./09-GARCH.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Conditional Heteroskedasticity</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>